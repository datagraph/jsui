<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Dydra.com — Reset Password" />
    <meta name="author" content="Dydra" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forgot your password? — Dydra</title>
    <link rel="shortcut icon" href="./favicon.ico" />
    <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
    <link rel="stylesheet" href="./stylesheets/style.css" media="screen" />
    <link rel="stylesheet" href="./stylesheets/jsui-overrides.css" media="screen" />
  </head>
  <body class="devise passwords new">
    <div id="header">
      <div class="wrapper">
        <a href="/" id="logo">Dydra</a>
        <div id="nav">
          <ul class="nav">
            <li><a href="http://docs.dydra.com/dydra">About</a></li>
            <li><a href="http://docs.dydra.com">Documentation</a></li>
            <li><a href="http://blog.dydra.com">Blog</a></li>
            <li><a href="/login">Login</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div id="main">
      <div id="main-0">
        <div class="wrapper">
          <div id="content">
            <h1 id="content-title">Forgot your password?</h1>
            <div id="error-messages" class="widget" style="display:none;">
              <div class="alert-error rounded">
                <p class="message">
                  <span class="icon icon-alert"></span>
                  <span id="error-text"></span>
                </p>
              </div>
            </div>
            <div id="success-message" class="widget" style="display:none;">
              <div class="alert-success rounded" style="padding:8px;">
                <p class="message">
                  <span id="success-text"></span>
                </p>
              </div>
            </div>
            <form id="reset-password-form" class="formtastic" action="/accounts/password" method="post">
              <fieldset class="inputs">
                <ol>
                  <li class="email optional">
                    <label for="account_email">Email address</label>
                    <input type="email" id="account_email" name="account[email]" required />
                  </li>
                </ol>
              </fieldset>
              <fieldset class="buttons">
                <ol>
                  <li class="commit"><input type="submit" value="Submit" /></li>
                </ol>
              </fieldset>
            </form>
          </div>
          <div id="aside">
            <h5>Already have an account?</h5>
            <p><a href="/login">Log in</a></p>
            <h5>Have an invite code?</h5>
            <p><a href="/signup">Register now</a></p>
            <a href="/confirmations/new">Didn't receive confirmation instructions?</a><br />
            <a href="/unlocks/new">Didn't receive unlock instructions?</a>
          </div>
        </div>
      </div>
    </div>
    <div id="footer">
      <div class="wrapper">
        <p id="copyright">
          A product of <a href="http://datagraph.org/">Datagraph, Inc.</a>
          &nbsp;&bull;&nbsp;<span><a href="http://docs.dydra.com/dydra">About</a></span>
          &nbsp;&bull;&nbsp;<span><a href="http://docs.dydra.com">Documentation</a></span>
          &nbsp;&bull;&nbsp;<span><a href="http://blog.dydra.com">Blog</a></span>
          &nbsp;&bull;&nbsp;<span><a href="/legal">Legal</a></span>
        </p>
        <p id="footer-links">
          <a href="https://github.com/dydra/support/blob/master/README.rst#readme">Support</a>
          &nbsp;&bull;&nbsp;
          <a href="https://github.com/dydra">GitHub</a>
          &nbsp;&bull;&nbsp;
          <a href="http://twitter.com/dydradata">Twitter</a>
          &nbsp;&bull;&nbsp;
          <a href="http://feeds.feedburner.com/dydra">RSS</a>
        </p>
      </div>
    </div>
    <script>
      document.getElementById("reset-password-form").addEventListener("submit", async function (e) {
        e.preventDefault();
        var form = this;
        var errorBox = document.getElementById("error-messages");
        var errorText = document.getElementById("error-text");
        var successBox = document.getElementById("success-message");
        var successText = document.getElementById("success-text");
        errorBox.style.display = "none";
        successBox.style.display = "none";

        var email = document.getElementById("account_email").value;
        if (!email) return;

        try {
          var response = await fetch(form.action, {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded", "Accept": "text/html" },
            body: "account%5Bemail%5D=" + encodeURIComponent(email),
          });

          if (response.ok || response.status === 302 || response.status === 303) {
            successBox.style.display = "block";
            successText.textContent = "If an account exists for " + email + ", you will receive password reset instructions shortly.";
            form.style.display = "none";
          } else {
            errorBox.style.display = "block";
            errorText.textContent = "Could not process your request. Please verify your email address and try again.";
          }
        } catch (err) {
          errorBox.style.display = "block";
          errorText.textContent = "Could not reach the server. Please try again later.";
        }
      });
    </script>
  </body>
</html>
